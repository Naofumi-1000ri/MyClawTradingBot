# myClaw Global Settings

# Environment: testnet or mainnet
environment: mainnet

# Hyperliquid API endpoints
hyperliquid:
  mainnet_url: "https://api.hyperliquid.xyz"
  testnet_url: "https://api.hyperliquid-testnet.xyz"

# Strategy (ゴム理論ベース、ルールベース)
strategy:
  rubber_wall:                   # BTC: BEAR spike → zone判定 (ゴムの壁)
    symbol: "BTC"
    vol_threshold: 5.0           # 旧7.0→5.0: upper 77%勝率 (30日BTデータ), 機会損失削減
                                 # zones: penetration(-20~0%→LONG), upper_range(40%~→SHORT)
                                 # upper_range TP=0.5%/SL=0.6% (旧TP=0.3%。EV -0.069%→+0.049%)
    quiet_long_enabled: false    # Pattern D 無効 (ISSUE-001: quiet系は出来高なしエントリー、ゴム理論の趣旨と矛盾)
    h4_window: 48
    vol_window: 288
    timeout_candles: 5
  rubber_band:                   # ETH: 3パターン ゴムバンド
    symbol: "ETH"
    reversal_threshold: 7.0      # Pattern A: >= this → LONG reversal (旧6.0→7.0)
    reversal_tp_pct: 0.005       # Pattern A: TP 0.5% (旧0.4%→0.5%)
    reversal_sl_pad_pct: 0.0005  # Pattern A: SL = candle low - 0.05% pad
    reversal_sl_min_dist: 0.0025 # Pattern A: SL最小距離0.25% (旧0.1%→0.25%, ノイズSL修正)
    reversal_h4_max_pct: 40      # Pattern A: 4H pos >= 40% → SKIP (上限フィルター)
                                 # 30日BT n=27: pos<40%でWR=70%, pos>=40%でWR=25%
                                 # 旧reversal_h4_filter_pct (下限フィルター) から変更
    momentum_threshold: 3.0      # Pattern B: >= this & < reversal → SHORT
                                 # 30日BT: mid(40-55%)+3.0xでSHORT_wr=88%(n=8)
    momentum_zone_min: 40        # Pattern B: 4H position >= 40% (30日BTで有効)
    momentum_cut_bars: 15        # Pattern B: 75分 (15bar) で時間カット
    momentum_sl_pad_pct: 0.0005  # Pattern B: SL = candle high + 0.05% pad
    momentum_sl_min_dist: 0.0035 # Pattern B: SL最小距離0.35% (旧0.30%→0.35%: 2/20+0.56%SLヒット対策)
    momentum_low_vol_skip: true  # Pattern B: low_vol regime時はSKIP (偽スパイク防止)
                                 # 2/21実績: low_vol下でB_momentum 4件WR=0% → BT(高ボラ想定)との乖離防止
    # Pattern C: quiet_long (静観脱却 - 2026-02-21追加)
    # スパイク不要。低出来高+GOLDEN+4H中位以下 → LONG
    # 30日BT n=22: WR=68.2%, EV=+0.179%, 約1.5件/日 (h4_max_pct緩和後)
    quiet_long_enabled: false         # Pattern C 無効 (ISSUE-001: quiet系は出来高なしエントリー、ゴム理論の趣旨と矛盾。本番全敗確認)
    quiet_long_h4_max_pct: 45         # 4H pos < 45% (旧50%→45%: 直近BTで40-50%ゾーンはtimeoutが多くEV低下確認)
    quiet_long_vol_ratio_max: 0.50    # 直近5本/100本平均 < 0.50 (旧0.60→0.50: 0.59ギリギリケースを除外し品質向上)
    quiet_long_vol_short_window: 5    # 直近N本の出来高平均
    quiet_long_vol_long_window: 100   # 比較対象の長期出来高平均
    quiet_long_tp_pct: 0.004          # TP 0.4% (30日BT最適: TP0.4/SL0.6/10bar)
    quiet_long_sl_pct: 0.006          # SL 0.6%
    quiet_long_cut_bars: 10           # 10bar (50分) タイムアウト
    quiet_long_use_4h_ema: true       # 5m DEAD でも 4H EMA GOLDEN なら発火許可 (confidence=0.72)
    h4_window: 48
    vol_window: 288
  wave_rider:                    # BTC: US Open 1h bar momentum (208日BT: PF=1.68, Sharpe=3.13)
    symbol: "BTC"
    enabled: true
    up_large_th: 0.006           # >=+0.6% → LONG (momentum follow)
    down_large_th: 0.008         # <=-0.8% → SHORT (momentum follow)
    up_medium_th: 0.002          # +0.2-0.6% → SHORT (fade)
    sl_pct: 0.008                # SL 0.8% (全パターン共通)
    reversion_enabled: true      # up_large後のリバージョンSHORT
    rev_tp_pct: 0.003            # REV TP 0.3% (19件WR=94.7%, p=0.008)
    rev_sl_pct: 0.008            # REV SL 0.8%
    rev_deviation_th: 0.008      # 乖離率>=0.8%で発動
  wave_rider_hype:               # HYPE: 木曜限定 US Open WR (BTC低相関ヘッジ, r=-0.82)
    symbol: "HYPE"
    enabled: true
    thursday_only: true          # 木曜のみ稼働 (N=5, WR=80%, PF=21.5, BTC木曜PnL相関r=-0.82)
    up_large_th: 0.030           # >=+3.0% → LONG (HYPE閾値はBTCの5倍)
    down_large_th: 0.030         # <=-3.0% → SHORT
    up_medium_th: 0.005          # +0.5-3.0% → SHORT (fade, 主力パターン)
    sl_pct: 0.008                # SL 0.8%
    reversion_enabled: false     # HYPEリバージョンは未検証
  sol_rubber_wall:               # SOL: BTC型ゴムの壁 (BEAR spike → SHORT メイン)
    symbol: "SOL"
    vol_threshold: 5.5           # 旧6.5→5.5: 6.5xは機会が少なすぎ。5.5xで頻度増加 (静観脱却)
    deep_threshold: 7.0          # deep_below LONG: 7x+ 高閾値 (deep_reversalは一時無効化中)
    quiet_short_enabled: false   # Pattern E 無効 (ISSUE-001: SOL 57件 PF=0.11 本番全敗。出来高なしエントリーはゴム理論と矛盾)
    h4_window: 48
    vol_window: 288

# Trading pairs to monitor (データ収集対象。トレード対象は strategy で制御)
trading:
  symbols:
    - "BTC"
    - "ETH"
    - "SOL"
    - "HYPE"
  default_leverage: 3
  max_leverage: 10
  min_confidence: 0.7
  decision_gate:
    partial_consensus_min_confidence: 0.72
    entry_cooldown_minutes: 10
    max_equity_drift_pct: 20.0
    max_daily_loss_for_new_entries_pct: 2.0
    min_rr: 1.0
    min_data_quality_score: 80
    close_only_score_threshold: 80
    kill_switch_proposal_score_threshold: 60
    max_spread_bps: 8.0
    min_orderbook_imbalance: 1.1
    min_orderbook_imbalance_by_symbol:
      BTC: 1.0
      ETH: 1.0
      SOL: 0.35
  position_scaling:
    enabled: true
    phase1_trades: 30
    phase2_trades: 50
    phase1_multiplier: 1.5
    phase2_multiplier: 2.0
    degraded_mode_multiplier: 1.0
    emergency_multiplier: 0.5
    min_expectancy_usd: 0.0
    max_drawdown_pct: 2.0
    max_low_score_events: 0
    low_score_threshold: 80
    loss_streak_limit: 3

# Brain settings (ルールベース戦略、LLM不使用)
brain:
  orderbook_depth: 5     # orderbook levels to include in context

# Cycle settings
cycle:
  interval_minutes: 5
  data_staleness_seconds: 300  # skip if data older than this

# Paths (relative to project root)
paths:
  data_dir: "data"
  signals_dir: "signals"
  state_dir: "state"
  logs_dir: "logs"

# Hypothesis Lab settings
hypothesis:
  archive_days: 7              # market_data archive retention
  max_hypotheses: 50           # max active hypotheses
  backtest_min_samples: 5      # min samples for basic backtest
  strict_min_samples: 10       # min samples for strict backtest
  shadow_min_activations: 5    # min activations before promotion
  shadow_min_winrate: 0.55     # min win rate for promotion
  proven_confidence_bonus: 0.05  # confidence bonus for proven hypotheses

# Telegram notifications
telegram:
  bot_token: ""
  chat_id: 0
  enabled: true
  # bot_token and chat_id loaded from secrets
